C251 COMPILER V5.60.0,  main                                                               08/01/26  16:51:33  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE main
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\AI-KEIL5\C251\BIN\C251.EXE Sources\main.c XSMALL BROWSE INCDIR(.\Sources) DEBUG PRINT(.\Listings
                    -\main.lst) OBJECT(.\Objects\main.obj) 

stmt  level    source

    1          //main.c
    2          //程序主函数
    3          //SPI驱动OLED显示图片、图形、字符
    4          //1.增加USB不停电下载功能
    5          //2.屏幕使用硬件SPI，尺寸0.96，驱动IC:SSD1315
    6          //3.目前已测试函数：
    7          /*
    8              1.2026-01-07    test_oled_duibidu();//产生现象为图案渐灭渐亮
    9                              test_6_gray_img();//测试6阶灰度图像显示
   10                              test_dis_line();//测试显示线
   11          4.主频40MHZ 
   12          */
   13          
   14          #include "config.h"                     //头文件中已包含ai8051u.h, ai_usb.h以及其他头文件
   15          #include "pic.h"
   16          #include "oled.h"
   17          #include  "ai_usb.h"    //USB库和USB虚拟设备的头文
   18          #include "adc_key.h"
   19          #include "time.h"
   20          
   21          void delay_ms(unsigned int ms);
   22          
   23          void main()
   24          {
   25   1          unsigned char i;
   26   1      
   27   1          SYS_Init();              //系统初始化
   28   1          OLED_Init();             //初始化
   29   1          OLED_CLS();              //清屏
   30   1          OLED_Light(0x80);        //中间亮度
   31   1          OLED_CLS();              //清屏
   32   1              usb_init();
   33   1          Timer0_Init();
   34   1          adc_key_init();
   35   1          EA = 1;                 //使能全局中断
   36   1      
   37   1          for(i=0;i<128;i++)
   38   1          {
   39   2              WaveData[i]=mid_level_num;
   40   2          }
   41   1      
   42   1          while (1)
   43   1          {   
   44   2              //test_oled_duibidu();//产生现象为图案渐灭渐亮
   45   2              //test_6_gray_img();//测试6阶灰度图像显示
   46   2              //test_dis_line();//测试显示线
   47   2              //test_dis_boxing();测试静态波形图
   48   2              //ButtonWave();按键波动图形显示
   49   2              //time_out();
   50   2      
   51   2              // oled_draw_line(64,32,0,0,1,5);OLED_Show();delay_ms(500);
   52   2              // oled_draw_line(64,32,64,0,1,5);OLED_Show();delay_ms(500);
   53   2              // oled_draw_line(64,32,127,0,1,5);OLED_Show();delay_ms(500);
   54   2              // oled_draw_line(64,32,127,32,1,5);OLED_Show();delay_ms(500);
   55   2      
   56   2              // oled_draw_line(64,32,127,64,1,5);OLED_Show();delay_ms(500);
   57   2              // oled_draw_line(64,32,64,64,1,5);OLED_Show();delay_ms(500);
   58   2              // oled_draw_line(64,32,0,64,1,5);OLED_Show();delay_ms(500);
C251 COMPILER V5.60.0,  main                                                               08/01/26  16:51:33  PAGE 2   

   59   2              // oled_draw_line(64,32,0,32,1,5);OLED_Show();delay_ms(500);
   60   2              
   61   2              //oled_draw_frame(0,0,127,63);OLED_Show();delay_ms(500);
   62   2              //oled_drawblock(32,0,64,63);OLED_Show();delay_ms(500);
   63   2              oled_draw_line(0,32,127,32,1,2);OLED_Show();
   64   2              oled_draw_line(64,0,64,64,1,2);OLED_Show();
   65   2              oled_drawsin();
   66   2          }
   67   1      }
   68          
   69          void SYS_Init(void)                 //系统初始化函数
   70          {
   71   1          EAXFR = 1;                      //使能访问扩展XFR
   72   1          WTST = 0x00;                    //设置最快速度访问程序代码
   73   1          CKCON = 0x00;                   //设置最快速度访问内部XDATA
   74   1          
   75   1          P0M1 = 0x00;   P0M0 = 0x00;     //设置为准双向口
   76   1          P1M1 = 0x00;   P1M0 = 0x00;     //设置为准双向口
   77   1          P2M1 = 0x00;   P2M0 = 0x00;     //设置为准双向口
   78   1          P3M1 = 0x00;   P3M0 = 0x2c;     //设置为准双向口, P3.2,P3.3,P3.5设置为推挽输出
   79   1          P4M1 = 0x00;   P4M0 = 0x80;     //设置为准双向口, P4.7设置为推挽输出
   80   1          P5M1 = 0x00;   P5M0 = 0x00;     //设置为准双向口
   81   1          P6M1 = 0x00;   P6M0 = 0x00;     //设置为准双向口
   82   1          P7M1 = 0x00;   P7M0 = 0x00;     //设置为准双向口
   83   1      
   84   1          P3SR = 0x00;                    //电平转换速度快（改善IO口高速翻转信号）
   85   1          P3DR = 0xff;                    //端口驱动电流增强
   86   1      }
   87          
   88          //========================================================================
   89          // 函数: void delay_ms(unsigned int ms)
   90          // 描述: 毫秒级延时函数。
   91          // 参数: ms,要延时的ms数,自动适应主时钟.
   92          //=====================================================================
   93          void delay_ms(unsigned int ms)
   94          {
   95   1          unsigned int i;
   96   1          do{
   97   2              i = MAIN_Fosc / 6000;
   98   2              while(--i);
   99   2          } while(--ms);
  100   1      }


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       217     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =    ------     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =         2     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
